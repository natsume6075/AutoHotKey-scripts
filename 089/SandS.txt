Autohotkey Space & Shift動作(SandS.ahk)
    2000/XP系対応  (Autohotkey v.1.0.34以降)
                                             2008.09.21

.■動作環境
    AutoHotkey 1.0.34以降くらい
    OS: NT系
    動作確認OS XP SP1

.■概要
    2ちゃんのスレで話題になった Space & Shiftキースクリプトです。
    > Spaceキー普通に押して離したらA_Space出力
    > 押しっぱなしで、他の文字キー押すときはシフトキーの働きするﾔﾂ。
    という事らしいです。

.■特徴
    オプションでIMEON/OFF状態の挙動を変えられるみたいです。
   > １．IME/OFFの時だけSandSが機能するようにする
   > ２．IME/OFFの時だけ[無変換]や[変換]をスペースキーにする
   > ３．[無変換]+[変換]でIME ON/OFFを切り換える

   ※ SandS の実行方法について
      SandS判定中は[Space]キーが離されるまでの間、Inputコマンドで入力を横取りし
      フィルタリングしてからSendしてます。ですが単体スペース入力用に
      タイムアウト値を短く取っているせいか タイミング的にInputで横取りできずに
      生のキー押下情報が排出されることがあるようです。
      前バージョンでは、[Space]押下中ずっとShift Down状態にしてたため
      取りこぼされたキーもShiftが効いた状態で排出されていて気がつかなかったんですが
      これだと除去できなかったスペースが入力されてしまうことがあるようです。
      また、[1]や[3]を押した時に[!],[#]が上手く入力できないみたいなので
      実行モードを幾つか選べるようにしました。
      SandS.ahk の最初の方にある sas_ExeMode で値を指定して下さい

        0: [Space]押下中は [Shift]押しっぱなし
           従来の方式、スペースが時々挿入されたり、!や#が効かなかったりする。

        1: 送信時以外は [Shift]オフ
           [1]や[3]を押した時に[!],[#]が上手く入力できないのを対応
           Shift切ってるので取りこぼしが増えてます。Space挿入問題も多分未解決

        2: 1 かつ BlockInputを使用
           取りこぼし問題対応、動作としては一番まとも。
           ただしSandS判定中はマウス操作も一切効かなくなってしまいます。

        モードを1にした場合、Inputのタイムアウト時間を長く取ると取りこぼしが
        減るかも知れません。（うちの環境では 0.5にしたら出なくなった）
        そのかわり単体スペース入力で待たされる時間が増えます。
        sas_InputTimout で適当に時間調整してください。

.■ファイル構成
    SandS.ahk       スクリプト本体
    lib\IME.ahk     IME判定用スクリプト

.■使用方法
  IME.ahkを AutoHotkey.exeのあるフォルダ内の「Lib」か
  「%A_MyDocuments%\AutoHotkey\Lib\」に突っ込む。
  もしくは SandS.ahk で Includeしておく。

..◆単体起動
   スクリプトをそのまま実行
 
..◆組込み
   AutoHotkey.iniなどに組込んで使う場合、AutoExecute セクションに

     #Include SandS.ahk
     Gosub,SAS_Init

   を入れる。

.■削除方法
    全てのファイルを削除して下さい。
    本スクリプトではレジストリへの読み書きみはしていません。

.■注意事項
  ・製作者は Space&Shiftを使ったことがないため動作認識に間違いがある可能性があります。
  ・最初に作った当時とPC環境が変わっているので動作検証に自信がありません。
    常用してるノート(ThinkPad)だとキーボードの挙動が微妙に違ったり。
    一応デスクトップ機でもテストして見ましたがかなり怪しいです。

.■改変・再配布
    改変・再配布ともにご自由にどうぞ
    NYSLとかいうライセンスがあるらしいので、それでひとつ。
    http://www.kmonos.net/nysl/

.■履歴
   2008.09.21 見直したら何か色々間違ってたので修正
      ・IME判定モジュールの修正
      ・ホットキー関係の記述を修正
      ・サブルーチン撤廃、全部Function化
      ・[Space]押下中、キーリピートでイベントが多重発生してたので入口と出口で
        Hotkey ON/OFFするようにした。
      ・SandS判定中、Send,{Shift Down}したままだと、拾えないキーがあったので
        ([1]とか)送信時のみ Shift送信するモード追加。
       ・↑の変更でInputで取りこぼしたキーが時折そのまま入力されてしまうため
         ループの入口と出口で BlockInputをON/OFFするモードも追加
         Space押下中はマウスの操作も一切効かないのでスクリプトハング時はやばいかも。
         キーボードの入力だけBlockする方法があればいいんだけどよくわからない。

   2005.5.20
      IMEモジュールの Function化

   2005.3.27
      IMEの状態取得/セット方法を変更
      (Cソースを提供して下さった 投稿スレ86氏 に感謝)
      スペルミスとか修正

   2005.3.22
     2ちゃんのスレに張ったのをまとめてみる。
     いんちきIME制御搭載
[EOF]
